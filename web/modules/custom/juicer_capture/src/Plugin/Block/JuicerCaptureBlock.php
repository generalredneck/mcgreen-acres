<?php

namespace Drupal\juicer_capture\Plugin\Block;

use Drupal\Core\Url;
use Drupal\Core\Render\Markup;
use Drupal\Core\Block\BlockBase;
use Drupal\Core\Cache\CacheBackendInterface;
use Drupal\Core\Plugin\ContainerFactoryPluginInterface;
use Symfony\Component\DependencyInjection\ContainerInterface;

 /**
 * @Block(
 *   id = "juicer_capture_block",
 *   admin_label = @Translation("Juicer Capture Block")
 * )
 */
class JuicerCaptureBlock extends BlockBase implements ContainerFactoryPluginInterface {

  protected $cache;

  public function __construct(array $configuration, $plugin_id, $plugin_definition, CacheBackendInterface $cache) {
    parent::__construct($configuration, $plugin_id, $plugin_definition);
    $this->cache = $cache;
  }

  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition) {
    return new static(
      $configuration,
      $plugin_id,
      $plugin_definition,
      $container->get('cache.juicer_capture')
    );
  }

  public function build()
  {
    $cached = $this->cache->get('juicer_capture.cached_feed');
    $token = \Drupal::service('csrf_token')->get('juicer_capture_post');
    $session = \Drupal::request()->getSession();
    $session->set('juicer_capture_csrf_token', $token);
    $temp_markup = <<<HTML
    <!-- Juicer Capture Cached Feed 2025-11-20 21:59:31 -->      <script src="https://assets.juicer.io/embed.js" type="text/javascript"></script>\n      <link href="https://assets.juicer.io/embed.css" media="all" rel="stylesheet" type="text/css" />\n      <ul class="juicer-feed j-initialized j-modern j-desktop modern loaded" data-feed-id="mcgreenacres" data-origin="iframe" data-overlay="false">\n        <h1 class="referral "><a href="https://www.juicer.io/?utm_source=JuicerFreeFeed&amp;utm_medium=feed_ads&amp;utm_campaign=PoweredByTopLink&amp;utm_term=https://www.juicer.io/api/feeds/mcgreenacres/iframe&amp;referrer=www.juicer.io&amp;utm_id=mcgreenacres">Powered by</a></h1>\n        <div class="j-stacker-wrapper" style="margin-left: -10px; margin-right: -10px;">\n          <div class="">\n            <div class="row"><div class='column-1 col-md-4 col-lg-4'><li class="feed-item j-facebook j-facebook-bg image-post McGreenAcres  j-feed  is-not-youTube" data-blurred="false" data-id="502629718" data-source="facebook" style="margin-bottom: 20px; zoom: 1; opacity: 1;" tabindex="0" aria-label="Social media post"><div class="j-poster"><a aria-label="Photo from McGreen Acres on Facebook at 11/16/25 at 7:03AM (opens in new window)" href="https://facebook.com/profile.php?id=441159036725930" target="_blank" tabindex="-1"><img alt="Profile image for McGreen Acres" aria-hidden="true" data-lazy="https://www.juicer.io/silhouette-avatar.jpg" data-poster-id="441159036725930" tabindex="-1" src="https://scontent-dfw5-1.xx.fbcdn.net/v/t39.30808-1/279775344_426828022779127_699712270259180153_n.jpg?stp=cp0_dst-jpg_s50x50_tt6&amp;_nc_cat=105&amp;ccb=1-7&amp;_nc_sid=f907e8&amp;_nc_ohc=BoI7rEbTaCkQ7kNvwGQqLq0&amp;_nc_oc=Adl1uJsqrHaoUV-iXluWu9KdkgIHDTUn-Yfte7nRfKHrF1hAMe_VU9tffccqAzHJSzQ&amp;_nc_zt=24&amp;_nc_ht=scontent-dfw5-1.xx&amp;edm=AOf6bZoEAAAA&amp;_nc_gid=-ibrl-GqzwbX7dd_B9bGUA&amp;oh=00_Afh-N8tpsshlbASznEKHpHwLwQdE2B0U3W98sicvePDIIA&amp;oe=6925ACB8"><h3>McGreen Acres</h3><time class="j-date" datetime="2025-11-16T05:03:04.000-08:00">4d</time></a></div><a class="j-image" data-external-id="1474341048027814" data-image="https://www.juicer.io/api/posts/502629718/images.jpg?external_id=1474341048027814&amp;s=c54414b255c11b5220296842b5fc2c3700d7cf06" data-video-url="https://www.juicer.io/api/posts/502629718/images.jpg?external_id=1474341048027814&amp;s=c54414b255c11b5220296842b5fc2c3700d7cf06" href="https://www.facebook.com/441159036725930/posts/1474341048027814" target="_blank" tabindex="-1" aria-label="Photo from McGreen Acres on Facebook at 11/16/25 at 7:03AM (opens in new window)"><img alt="Photo from McGreen Acres on Facebook at 11/16/25 at 7:03AM" class="j-content-image" data-lazy="https://www.juicer.io/api/posts/502629718/images.jpg?external_id=1474341048027814&amp;s=c54414b255c11b5220296842b5fc2c3700d7cf06" style="width: 100%; height: auto; display: block; margin-left: auto; margin-right: auto;" src="https://www.juicer.io/api/posts/502629718/images.jpg?external_id=1474341048027814&amp;s=c54414b255c11b5220296842b5fc2c3700d7cf06"></a><div class="j-text"><div class="j-message"><p>Our potbelly pig Peaches says "Boop"<br><br>You can read some about our animals, like our cows on our blog.<br><br><a target="_blank" class="auto" href="https://mcgreenacres.com/blog/cattle/meet-ladies-behind-milk" tabindex="-1" aria-label="https://mcgreenacres.com/blog/cattle/meet-ladies-behind-milk (opens in new window)">https://mcgreenacres.com/blog/cattle/meet-ladies-behind-milk</a></p></div><div class="j-meta"><div class="j-link-container"><ul><li><a aria-label="4 Comments (opens in new window)" class="comments" href="https://www.facebook.com/441159036725930/posts/1474341048027814" target="_blank" tabindex="-1">4</a></li><li><a aria-label="34 Likes (opens in new window)" class="likes" href="https://www.facebook.com/441159036725930/posts/1474341048027814" target="_blank" tabindex="-1">34</a></li></ul></div><nav><a aria-label="facebook (opens in new window)" class="j-social j-facebook j-facebook-text-hover" href="https://www.facebook.com/441159036725930/posts/1474341048027814" target="_blank" tabindex="-1"></a></nav></div></div></li><li class="feed-item j-facebook j-facebook-bg image-post McGreenAcres  j-feed  is-not-youTube" data-blurred="false" data-id="502545844" data-source="facebook" style="margin-bottom: 20px; zoom: 1; opacity: 1;" tabindex="0" aria-label="Social media post"><div class="j-poster"><a aria-label="Photo from McGreen Acres on Facebook at 11/11/25 at 4:30PM (opens in new window)" href="https://facebook.com/profile.php?id=441159036725930" target="_blank" tabindex="-1"><img alt="Profile image for McGreen Acres" aria-hidden="true" data-lazy="https://www.juicer.io/silhouette-avatar.jpg" data-poster-id="441159036725930" tabindex="-1" src="https://scontent-dfw5-1.xx.fbcdn.net/v/t39.30808-1/279775344_426828022779127_699712270259180153_n.jpg?stp=cp0_dst-jpg_s50x50_tt6&amp;_nc_cat=105&amp;ccb=1-7&amp;_nc_sid=f907e8&amp;_nc_ohc=BoI7rEbTaCkQ7kNvwGQqLq0&amp;_nc_oc=Adl1uJsqrHaoUV-iXluWu9KdkgIHDTUn-Yfte7nRfKHrF1hAMe_VU9tffccqAzHJSzQ&amp;_nc_zt=24&amp;_nc_ht=scontent-dfw5-1.xx&amp;edm=AOf6bZoEAAAA&amp;_nc_gid=-ibrl-GqzwbX7dd_B9bGUA&amp;oh=00_Afh-N8tpsshlbASznEKHpHwLwQdE2B0U3W98sicvePDIIA&amp;oe=6925ACB8"><h3>McGreen Acres</h3><time class="j-date" datetime="2025-11-11T14:30:09.000-08:00">9d</time></a></div><a class="j-image" data-external-id="1470246248437294" data-image="https://www.juicer.io/api/posts/502545844/images.jpg?external_id=1470246248437294&amp;s=fc9441035a78b51fe85148c4e0f6de24646b0bb6" data-video-url="https://www.juicer.io/api/posts/502545844/images.jpg?external_id=1470246248437294&amp;s=fc9441035a78b51fe85148c4e0f6de24646b0bb6" href="https://www.facebook.com/441159036725930/posts/1470246248437294" target="_blank" tabindex="-1" aria-label="Photo from McGreen Acres on Facebook at 11/11/25 at 4:30PM (opens in new window)"><img alt="Photo from McGreen Acres on Facebook at 11/11/25 at 4:30PM" class="j-content-image" data-lazy="https://www.juicer.io/api/posts/502545844/images.jpg?external_id=1470246248437294&amp;s=fc9441035a78b51fe85148c4e0f6de24646b0bb6" style="width: 100%; height: auto; display: block; margin-left: auto; margin-right: auto;" src="https://www.juicer.io/api/posts/502545844/images.jpg?external_id=1470246248437294&amp;s=fc9441035a78b51fe85148c4e0f6de24646b0bb6"></a><div class="j-text"><div class="j-message"><p>We've put together something special. An easy 3-recipe guide to create dairy your family will love. If you want to check it out, mosey over to <a target="_blank" class="auto" href="https://mcgreenacres.com/form/dairy-newsletter" tabindex="-1" aria-label="https://mcgreenacres.com/form/dairy-newsletter (opens in new window)">https://mcgreenacres.com/form/dairy-newsletter</a> and we'll get it emailed to you.</p></div><div class="j-meta"><div class="j-link-container"></div><nav><a aria-label="facebook (opens in new window)" class="j-social j-facebook j-facebook-text-hover" href="https://www.facebook.com/441159036725930/posts/1470246248437294" target="_blank" tabindex="-1"></a></nav></div></div></li></div><div class='column-2 col-md-4 col-lg-4'><li class="feed-item j-facebook j-facebook-bg j-video McGreenAcres  j-feed  is-not-youTube" data-blurred="false" data-id="502471659" data-source="facebook" style="margin-bottom: 20px; zoom: 1; opacity: 1;" tabindex="0" aria-label="Social media post"><div class="j-poster"><a aria-label="Photo from McGreen Acres on Facebook at 11/9/25 at 6:51AM (opens in new window)" href="https://facebook.com/profile.php?id=441159036725930" target="_blank" tabindex="-1"><img alt="Profile image for McGreen Acres" aria-hidden="true" data-lazy="https://www.juicer.io/silhouette-avatar.jpg" data-poster-id="441159036725930" tabindex="-1" src="https://scontent-dfw5-1.xx.fbcdn.net/v/t39.30808-1/279775344_426828022779127_699712270259180153_n.jpg?stp=cp0_dst-jpg_s50x50_tt6&amp;_nc_cat=105&amp;ccb=1-7&amp;_nc_sid=f907e8&amp;_nc_ohc=BoI7rEbTaCkQ7kNvwGQqLq0&amp;_nc_oc=Adl1uJsqrHaoUV-iXluWu9KdkgIHDTUn-Yfte7nRfKHrF1hAMe_VU9tffccqAzHJSzQ&amp;_nc_zt=24&amp;_nc_ht=scontent-dfw5-1.xx&amp;edm=AOf6bZoEAAAA&amp;_nc_gid=-ibrl-GqzwbX7dd_B9bGUA&amp;oh=00_Afh-N8tpsshlbASznEKHpHwLwQdE2B0U3W98sicvePDIIA&amp;oe=6925ACB8"><h3>McGreen Acres</h3><time class="j-date" datetime="2025-11-09T04:51:50.000-08:00">11d</time></a></div><a class="j-image" data-external-id="1467899918671927" data-image="https://www.juicer.io/api/posts/502471659/images.jpg?external_id=1467899918671927&amp;s=5a30c6f3adf1b071f3a2cc3cd7824dfa927d3b18" data-video-url="https://www.juicer.io/api/posts/502471659/videos.mp4?external_id=1467899918671927&amp;s=5a30c6f3adf1b071f3a2cc3cd7824dfa927d3b18" href="https://www.facebook.com/441159036725930/posts/1467899918671927" target="_blank" tabindex="-1" aria-label="Photo from McGreen Acres on Facebook at 11/9/25 at 6:51AM (opens in new window)"><img alt="Photo from McGreen Acres on Facebook at 11/9/25 at 6:51AM" class="j-content-image" data-lazy="https://www.juicer.io/api/posts/502471659/images.jpg?external_id=1467899918671927&amp;s=5a30c6f3adf1b071f3a2cc3cd7824dfa927d3b18" style="width: 100%; height: auto; display: block; margin-left: auto; margin-right: auto;" src="https://www.juicer.io/api/posts/502471659/images.jpg?external_id=1467899918671927&amp;s=5a30c6f3adf1b071f3a2cc3cd7824dfa927d3b18"></a><div class="j-text"><div class="j-message"><p>Since our herd share isn't full up. Beverly and Allan were making butter last night for the freezer using our raw milk. We'll share the process with you when you sign up.<br><br><a target="_blank" class="auto" href="https://mcgreenacres.com/product/23" tabindex="-1" aria-label="https://mcgreenacres.com/product/23 (opens in new window)">https://mcgreenacres.com/product/23</a></p></div><div class="j-meta"><div class="j-link-container"><ul><li><a aria-label="3 Likes (opens in new window)" class="likes" href="https://www.facebook.com/441159036725930/posts/1467899918671927" target="_blank" tabindex="-1">3</a></li></ul></div><nav><a aria-label="facebook (opens in new window)" class="j-social j-facebook j-facebook-text-hover" href="https://www.facebook.com/441159036725930/posts/1467899918671927" target="_blank" tabindex="-1"></a></nav></div></div></li><li class="feed-item j-facebook j-facebook-bg image-post McGreenAcres  j-feed  is-not-youTube" data-blurred="false" data-id="502349752" data-source="facebook" style="margin-bottom: 20px; zoom: 1; opacity: 1;" tabindex="0" aria-label="Social media post"><div class="j-poster"><a aria-label="Photo from McGreen Acres on Facebook at 11/3/25 at 12:46PM (opens in new window)" href="https://facebook.com/profile.php?id=441159036725930" target="_blank" tabindex="-1"><img alt="Profile image for McGreen Acres" aria-hidden="true" data-lazy="https://www.juicer.io/silhouette-avatar.jpg" data-poster-id="441159036725930" tabindex="-1" src="https://scontent-dfw5-1.xx.fbcdn.net/v/t39.30808-1/279775344_426828022779127_699712270259180153_n.jpg?stp=cp0_dst-jpg_s50x50_tt6&amp;_nc_cat=105&amp;ccb=1-7&amp;_nc_sid=f907e8&amp;_nc_ohc=BoI7rEbTaCkQ7kNvwGQqLq0&amp;_nc_oc=Adl1uJsqrHaoUV-iXluWu9KdkgIHDTUn-Yfte7nRfKHrF1hAMe_VU9tffccqAzHJSzQ&amp;_nc_zt=24&amp;_nc_ht=scontent-dfw5-1.xx&amp;edm=AOf6bZoEAAAA&amp;_nc_gid=-ibrl-GqzwbX7dd_B9bGUA&amp;oh=00_Afh-N8tpsshlbASznEKHpHwLwQdE2B0U3W98sicvePDIIA&amp;oe=6925ACB8"><h3>McGreen Acres</h3><time class="j-date" datetime="2025-11-03T10:46:08.000-08:00">17d</time></a></div><a class="j-image" data-external-id="1462248682570384" data-image="https://www.juicer.io/api/posts/502349752/images.jpg?external_id=1462248682570384&amp;s=5ce7497ba6686777013f9610f20881ab0e745f60" data-video-url="https://www.juicer.io/api/posts/502349752/images.jpg?external_id=1462248682570384&amp;s=5ce7497ba6686777013f9610f20881ab0e745f60" href="https://www.facebook.com/441159036725930/posts/1462248682570384" target="_blank" tabindex="-1" aria-label="Photo from McGreen Acres on Facebook at 11/3/25 at 12:46PM (opens in new window)"><img alt="Photo from McGreen Acres on Facebook at 11/3/25 at 12:46PM" class="j-content-image" data-lazy="https://www.juicer.io/api/posts/502349752/images.jpg?external_id=1462248682570384&amp;s=5ce7497ba6686777013f9610f20881ab0e745f60" style="width: 100%; height: auto; display: block; margin-left: auto; margin-right: auto;" src="https://www.juicer.io/api/posts/502349752/images.jpg?external_id=1462248682570384&amp;s=5ce7497ba6686777013f9610f20881ab0e745f60"></a><div class="j-text"><div class="j-message"><p>Milk's flowin'!  We are officially opening up our herd share to new members. Give your family unprocessed, nutrient-rich milk straight from the source. With our herd share program, you will receive milk that\u2019s just the way nature made it, with nothing added and nothing taken away.<br><br>With so many people that contact us every day about raw milk, we expect the shares to go fast.  We are a really small operation, so we don\u2019t have very many open slots!<br><br><a target="_blank" class="auto" href="https://mcgreenacres.com/product/23" tabindex="-1" aria-label="https://mcgreenacres.com/product/23 (opens in new window)">https://mcgreenacres.com/product/23</a></p></div><div class="j-meta"><div class="j-link-container"></div><nav><a aria-label="facebook (opens in new window)" class="j-social j-facebook j-facebook-text-hover" href="https://www.facebook.com/441159036725930/posts/1462248682570384" target="_blank" tabindex="-1"></a></nav></div></div></li></div><div class='column-3 col-md-4 col-lg-4'><li class="feed-item j-facebook j-facebook-bg image-post McGreenAcres  j-feed  is-not-youTube" data-blurred="false" data-id="501291695" data-source="facebook" style="margin-bottom: 20px; zoom: 1; opacity: 1;" tabindex="0" aria-label="Social media post"><div class="j-poster"><a aria-label="Photo from McGreen Acres on Facebook at 9/26/25 at 11:38AM (opens in new window)" href="https://facebook.com/profile.php?id=441159036725930" target="_blank" tabindex="-1"><img alt="Profile image for McGreen Acres" aria-hidden="true" data-lazy="https://www.juicer.io/silhouette-avatar.jpg" data-poster-id="441159036725930" tabindex="-1" src="https://scontent-dfw5-1.xx.fbcdn.net/v/t39.30808-1/279775344_426828022779127_699712270259180153_n.jpg?stp=cp0_dst-jpg_s50x50_tt6&amp;_nc_cat=105&amp;ccb=1-7&amp;_nc_sid=f907e8&amp;_nc_ohc=BoI7rEbTaCkQ7kNvwGQqLq0&amp;_nc_oc=Adl1uJsqrHaoUV-iXluWu9KdkgIHDTUn-Yfte7nRfKHrF1hAMe_VU9tffccqAzHJSzQ&amp;_nc_zt=24&amp;_nc_ht=scontent-dfw5-1.xx&amp;edm=AOf6bZoEAAAA&amp;_nc_gid=-ibrl-GqzwbX7dd_B9bGUA&amp;oh=00_Afh-N8tpsshlbASznEKHpHwLwQdE2B0U3W98sicvePDIIA&amp;oe=6925ACB8"><h3>McGreen Acres</h3><time class="j-date" datetime="2025-09-26T09:38:47.000-07:00">55d</time></a></div><a class="j-image" data-external-id="1424664012995518" data-image="https://www.juicer.io/api/posts/501291695/images.jpg?external_id=1424664012995518&amp;s=cb871cc991e9f975c0ecdf450d279e8e9b988527" data-video-url="https://www.juicer.io/api/posts/501291695/images.jpg?external_id=1424664012995518&amp;s=cb871cc991e9f975c0ecdf450d279e8e9b988527" href="https://www.facebook.com/441159036725930/posts/1424664012995518" target="_blank" tabindex="-1" aria-label="Photo from McGreen Acres on Facebook at 9/26/25 at 11:38AM (opens in new window)"><img alt="Photo from McGreen Acres on Facebook at 9/26/25 at 11:38AM" class="j-content-image" data-lazy="https://www.juicer.io/api/posts/501291695/images.jpg?external_id=1424664012995518&amp;s=cb871cc991e9f975c0ecdf450d279e8e9b988527" style="width: 100%; height: auto; display: block; margin-left: auto; margin-right: auto;" src="https://www.juicer.io/api/posts/501291695/images.jpg?external_id=1424664012995518&amp;s=cb871cc991e9f975c0ecdf450d279e8e9b988527"></a><div class="j-text"><div class="j-message"><p>Are you looking to know what is going into your food?  Do you like to have a food reserve in case times get hard? Or do you just want to have a healthy option to pull you through the winter months?<br><br>Let us provide you with a local, heath aware, corn/soy free, pasture raised option. From a local family farm, to your freezer.<br><br>Grab a claim on a half/whole pig: mcgreenacres.com/pork-deposit<br><br>We have a limited supply of Half/Whole pigs that can be processed and packaged for the freezer. <br><br>Worried about having the space? A half pig only takes up about 3-4 cu. ft. This is a couple fridge freezer spaces (the top),  a brand new small ~$100 freezer, or roughly a 1/6th of most traditional large freezers. <br><br>It's your pick on the cuts. We (or the processor BlueBonnet Meat company) will walk you through the cut sheet.<br><br>Need more info on how this all works? See our easy 6 step process with pricing information: <a target="_blank" class="auto" href="https://mcgreenacres.com/blog/pigs/how-buy-a-butchered-pig" tabindex="-1" aria-label="https://mcgreenacres.com/blog/pigs/how-buy-a-butchered-pig (opens in new window)">https://mcgreenacres.com/blog/pigs/how-buy-a-butchered-pig</a><br><br>It all ends October 15.</p></div><div class="j-meta"><div class="j-link-container"><ul><li><a aria-label="1 Likes (opens in new window)" class="likes" href="https://www.facebook.com/441159036725930/posts/1424664012995518" target="_blank" tabindex="-1">1</a></li></ul></div><nav><a aria-label="facebook (opens in new window)" class="j-social j-facebook j-facebook-text-hover" href="https://www.facebook.com/441159036725930/posts/1424664012995518" target="_blank" tabindex="-1"></a></nav></div></div></li><li class="feed-item j-facebook j-facebook-bg image-post McGreenAcres  j-feed  is-not-youTube" data-blurred="false" data-id="502174029" data-source="facebook" style="margin-bottom: 20px; zoom: 1; opacity: 1;" tabindex="0" aria-label="Social media post"><div class="j-poster"><a aria-label="Photo from McGreen Acres on Facebook at 10/28/25 at 5:54PM (opens in new window)" href="https://facebook.com/profile.php?id=441159036725930" target="_blank" tabindex="-1"><img alt="Profile image for McGreen Acres" aria-hidden="true" data-lazy="https://www.juicer.io/silhouette-avatar.jpg" data-poster-id="441159036725930" tabindex="-1" src="https://scontent-dfw5-1.xx.fbcdn.net/v/t39.30808-1/279775344_426828022779127_699712270259180153_n.jpg?stp=cp0_dst-jpg_s50x50_tt6&amp;_nc_cat=105&amp;ccb=1-7&amp;_nc_sid=f907e8&amp;_nc_ohc=BoI7rEbTaCkQ7kNvwGQqLq0&amp;_nc_oc=Adl1uJsqrHaoUV-iXluWu9KdkgIHDTUn-Yfte7nRfKHrF1hAMe_VU9tffccqAzHJSzQ&amp;_nc_zt=24&amp;_nc_ht=scontent-dfw5-1.xx&amp;edm=AOf6bZoEAAAA&amp;_nc_gid=-ibrl-GqzwbX7dd_B9bGUA&amp;oh=00_Afh-N8tpsshlbASznEKHpHwLwQdE2B0U3W98sicvePDIIA&amp;oe=6925ACB8"><h3>McGreen Acres</h3><time class="j-date" datetime="2025-10-28T15:54:55.000-07:00">23d</time></a></div><a class="j-image" data-external-id="1456803036448282" data-image="https://www.juicer.io/api/posts/502174029/images.jpg?external_id=1456803036448282&amp;s=f23a48868859717d800889178d190ecf2ddfbbbf" data-video-url="https://www.juicer.io/api/posts/502174029/images.jpg?external_id=1456803036448282&amp;s=f23a48868859717d800889178d190ecf2ddfbbbf" href="https://www.facebook.com/441159036725930/posts/1456803036448282" target="_blank" tabindex="-1" aria-label="Photo from McGreen Acres on Facebook at 10/28/25 at 5:54PM (opens in new window)"><img alt="Photo from McGreen Acres on Facebook at 10/28/25 at 5:54PM" class="j-content-image" data-lazy="https://www.juicer.io/api/posts/502174029/images.jpg?external_id=1456803036448282&amp;s=f23a48868859717d800889178d190ecf2ddfbbbf" style="width: 100%; height: auto; display: block; margin-left: auto; margin-right: auto;" src="https://www.juicer.io/api/posts/502174029/images.jpg?external_id=1456803036448282&amp;s=f23a48868859717d800889178d190ecf2ddfbbbf"></a><div class="j-text"><div class="j-message"><p>Meanwhile\u2026 at the McGreen Acres hen house\u2026 I guess no more eggs for the winter\u2026 Only getting about 3 a day out of 50 hens.</p></div><div class="j-meta"><div class="j-link-container"></div><nav><a aria-label="facebook (opens in new window)" class="j-social j-facebook j-facebook-text-hover" href="https://www.facebook.com/441159036725930/posts/1456803036448282" target="_blank" tabindex="-1"></a></nav></div></div></li></div></div></div></div></ul<>
    HTML;

    if ($temp_markup || ($cached && !empty($cached->data))) {
      return [
        '#type' => 'markup',
        '#markup' => Markup::create('<div id="juicer-capture-block-wrapper">' . $temp_markup . '</div>'),
        '#cache' => [
          'max-age' => 86400,        // Page & block can be cached for 1 day
          'tags' => ['juicer_capture'],
        ],
      ];
    }
    /*$markup = file_get_contents(__DIR__ . '/../../../McGreenAcres feed - Juicer Social-desktop.html');*/
    $markup = <<<HTML
<script src="https://assets.juicer.io/embed.js" type="text/javascript"></script>
<link href="https://assets.juicer.io/embed.css" media="all" rel="stylesheet" type="text/css" />
<ul class="juicer-feed" data-feed-id="mcgreenacres" data-per="7" data-pages="1">
  <h1 class="referral"><a href="https://www.juicer.io">Powered by Juicer.io</a></h1>
</ul>
HTML;
    return [
      '#type' => 'markup',
      '#markup' => Markup::create('<div id="juicer-capture-block-wrapper">' . $markup . '</div>'),
      '#cache' => [
        'max-age' => 0,              // Capturing mode → dynamic → no caching
      ],
      '#attached' => [
        'library' => ['juicer_capture/capture'],
        'drupalSettings' => [
          'juicerCapture' => [
            'capture' => TRUE,
            'endpoint' => Url::fromRoute('juicer_capture.store')->toString(),
            'selector' => '#juicer-capture-block-wrapper',
            'token' => $token,
          ],
        ],
      ],
    ];
  }

}
